{
	"info": {
		"name": "Trotti-UL E2E Tests",
		"description": "End-to-end test scenarios for critical business flows",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Complete User Journey",
			"item": [
				{
					"name": "Create Student Account",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Account created successfully', function () {",
									"    pm.response.to.have.status(201);",
									"    pm.response.to.have.header('Location');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"E2E Test User\",\n    \"birthDate\": \"2000-01-01\",\n    \"gender\": \"MALE\",\n    \"idul\": \"e2euser\",\n    \"email\": \"e2e.user@ulaval.ca\",\n    \"password\": \"TestPassword123!\",\n    \"role\": \"STUDENT\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/accounts",
							"host": ["{{baseUrl}}"],
							"path": ["accounts"]
						}
					}
				},
				{
					"name": "Login Student",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Login successful', function () {",
									"    pm.response.to.have.status(200);",
									"    const json = pm.response.json();",
									"    pm.expect(json.token).to.not.be.undefined;",
									"    pm.collectionVariables.set('studentToken', json.token);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"e2e.user@ulaval.ca\",\n    \"password\": \"TestPassword123!\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "login"]
						}
					}
				},
				{
					"name": "Add Pass to Cart",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Pass added to cart', function () {",
									"    pm.response.to.have.status(200);",
									"    const json = pm.response.json();",
									"    pm.expect(json.items).to.have.lengthOf(1);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "{{studentToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"maximumDailyTravelTime\": 30,\n    \"session\": \"A25\",\n    \"billingFrequency\": \"MONTHLY\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/order",
							"host": ["{{baseUrl}}"],
							"path": ["order"]
						}
					}
				},
				{
					"name": "Confirm Payment",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Payment processed', function () {",
									"    pm.response.to.have.status(200);",
									"    const json = pm.response.json();",
									"    pm.expect(json.transactionId).to.not.be.undefined;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "{{studentToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"cardNumber\": \"4111111111111111\",\n    \"cardHolderName\": \"E2E Test User\",\n    \"expirationDate\": \"2025-12\",\n    \"cvv\": \"123\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/order/confirm",
							"host": ["{{baseUrl}}"],
							"path": ["order", "confirm"]
						}
					}
				},
				{
					"name": "Get Ride Permits",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Ride permit created', function () {",
									"    pm.response.to.have.status(200);",
									"    const json = pm.response.json();",
									"    pm.expect(json).to.have.lengthOf.above(0);",
									"    pm.collectionVariables.set('ridePermitId', json[0].id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "{{studentToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/ride-permit",
							"host": ["{{baseUrl}}"],
							"path": ["ride-permit"]
						}
					}
				},
				{
					"name": "Request Unlock Code",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Unlock code generated', function () {",
									"    pm.response.to.have.status(200);",
									"    const json = pm.response.json();",
									"    pm.expect(json.unlockCode).to.not.be.undefined;",
									"    pm.collectionVariables.set('unlockCode', json.unlockCode);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "{{studentToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/trips/{{ridePermitId}}/unlock-code",
							"host": ["{{baseUrl}}"],
							"path": ["trips", "{{ridePermitId}}", "unlock-code"]
						}
					}
				},
				{
					"name": "Start Trip",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Trip started', function () {",
									"    pm.response.to.have.status(200);",
									"    const json = pm.response.json();",
									"    pm.expect(json.status).to.equal('ONGOING');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "{{studentToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"ridePermitId\": \"{{ridePermitId}}\",\n    \"unlockCode\": \"{{unlockCode}}\",\n    \"location\": \"VACHON\",\n    \"slotNumber\": \"1\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/trips/start",
							"host": ["{{baseUrl}}"],
							"path": ["trips", "start"]
						}
					}
				},
				{
					"name": "End Trip",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Trip completed', function () {",
									"    pm.response.to.have.status(200);",
									"    const json = pm.response.json();",
									"    pm.expect(json.status).to.equal('COMPLETED');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "{{studentToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"location\": \"PEPS\",\n    \"slotNumber\": \"2\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/trips/end",
							"host": ["{{baseUrl}}"],
							"path": ["trips", "end"]
						}
					}
				},
				{
					"name": "Verify Trip History",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Trip in history', function () {",
									"    pm.response.to.have.status(200);",
									"    const json = pm.response.json();",
									"    pm.expect(json).to.be.an('array');",
									"    pm.expect(json.length).to.be.greaterThan(0);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "{{studentToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/trips/history",
							"host": ["{{baseUrl}}"],
							"path": ["trips", "history"]
						}
					}
				}
			]
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "studentToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "ridePermitId",
			"value": "",
			"type": "string"
		},
		{
			"key": "unlockCode",
			"value": "",
			"type": "string"
		}
	]
}